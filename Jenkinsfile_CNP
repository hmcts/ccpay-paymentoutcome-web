#!groovy	
	
	@Library("Infrastructure")
	
	def type = "nodejs"
	def product = "ccpay"
	def component = "paymentoutcome-web"
	def yarnBuilder = new uk.gov.hmcts.contino.YarnBuilder(this)

	// Configure branches to sync with master branch
	def branchesToSync = ['demo', 'ithc', 'perftest']

	def secrets = [
		'ccpay-${env}': [
			secret('paymentoutcome-s2s-web', 'PAYMENTOUTCOME_S2S_OTP_SECRET')
		]
	]
	def vaultOverrides = [
		'preview': 'aat',
		'hmctsdemo': 'aat'
	]

	static LinkedHashMap<String, Object> secret(String secretName, String envVar) {
		[ $class: 'AzureKeyVaultSecret',
			secretType: 'Secret',
			name: secretName,
			version: '',
			envVariable: envVar
		]
	}
	
	
	withPipeline(type, product, component) {
	overrideVaultEnvironments(vaultOverrides)
	loadVaultSecrets(secrets)
	enableSlackNotifications('#cc-payments-tech')
	enableAksStagingDeployment()
	disableLegacyDeployment()
	after('checkout') {
		sh "yarn cache clean"
		echo 'ccpay-paymentoutcome-web checked out'
		echo PAYMENTOUTCOME_S2S_OTP_SECRET
	}
    after('build') {
      yarnBuilder.yarn('build')
		echo PAYMENTOUTCOME_S2S_OTP_SECRET
    }
	//Sync demo,ithc and perftest with master branch
	syncBranchesWithMaster(branchesToSync)
	}
